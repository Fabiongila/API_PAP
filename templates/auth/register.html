{% extends "base_auth.html" %}

{% block title %}Registar - AgroCaua{% endblock %}

{% block content %}
<form id="registerForm" class="space-y-6">
    <div>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Criar Conta</h2>
        <p class="text-sm text-gray-500">Junte-se ao AgroCaua</p>
    </div>
    
    <!-- Nome Field -->
    <div>
        <label for="nome" class="form-label">Nome Completo</label>
        <input 
            type="text" 
            id="nome" 
            name="nome" 
            required 
            class="form-input"
            placeholder="João Silva"
        >
    </div>
    
    <!-- Email Field -->
    <div>
        <label for="email" class="form-label">Email</label>
        <input 
            type="email" 
            id="email" 
            name="email" 
            required 
            class="form-input"
            placeholder="seu@email.com"
        >
    </div>
    
    <!-- Password Field -->
    <div>
        <label for="password" class="form-label">Senha</label>
        <input 
            type="password" 
            id="password" 
            name="password" 
            required 
            minlength="6"
            class="form-input"
            placeholder="••••••••"
        >
        <p class="text-xs text-gray-500 mt-1">Mínimo 6 caracteres</p>
    </div>
    
    <!-- Confirm Password Field -->
    <div>
        <label for="confirmPassword" class="form-label">Confirmar Senha</label>
        <input 
            type="password" 
            id="confirmPassword" 
            name="confirmPassword" 
            required 
            minlength="6"
            class="form-input"
            placeholder="••••••••"
        >
    </div>
    
    <!-- Submit Button -->
    <button 
        type="submit" 
        id="submitBtn"
        class="btn btn-primary w-full justify-center"
    >
        <span id="btnText">Criar Conta</span>
        <div id="btnSpinner" class="spinner hidden"></div>
    </button>
    
    <!-- Login Link -->
    <div class="text-center text-sm">
        <span class="text-gray-500">Já tens conta?</span>
        <a href="/login" class="text-green-600 hover:text-green-700 font-semibold ml-1">
            Entrar
        </a>
    </div>
</form>
{% endblock %}

{% block extra_scripts %}
<script>
    const registerForm = document.getElementById('registerForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    
    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const nome = document.getElementById('nome').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Validate password match
        if (password !== confirmPassword) {
            showError('As senhas não coincidem');
            return;
        }
        
        // Show loading state
        submitBtn.disabled = true;
        btnText.classList.add('hidden');
        btnSpinner.classList.remove('hidden');
        
        try {
            const response = await API.register(nome, email, password);
            const data = await response.json();
            
            if (response.ok) {
                // Show success message
                showSuccess('Conta criada com sucesso! Redirecionando...');
                
                // Redirect to login
                setTimeout(() => {
                    window.location.href = '/login';
                }, 1500);
            } else {
                // Show error message
                showError(data.erro || 'Erro ao criar conta');
                
                // Reset button
                submitBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnSpinner.classList.add('hidden');
            }
        } catch (error) {
            console.error('Register error:', error);
            showError('Erro ao criar conta. Tente novamente.');
            
            // Reset button
            submitBtn.disabled = false;
            btnText.classList.remove('hidden');
            btnSpinner.classList.add('hidden');
        }
    });
    
    // Clear token on page load
    clearToken();
</script>
{% endblock %}
